---
title: "Paper Figures Replication"
output: html_document
date: "2023-06-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load libraries.
```{r}
library(ggplot2)
library(gridExtra)
```

Load data.
```{r}
load("paper_replication_data.rdata")

# Remove 116th Congress from House lists - the data is incomplete
figure_A_results <- figure_A_results[figure_A_results$session != 116, ] 
figure_C_results <- figure_C_results[figure_C_results$session != 116, ] 
figure_E_results <- figure_E_results[figure_E_results$session != 116, ] 
```

```{r}
figure_B_results$session <- as.numeric(figure_B_results$session)
figure_A_results$session <- as.numeric(figure_A_results$session)
figure_C_results$session <- as.numeric(figure_C_results$session)
figure_D_results$session <- as.numeric(figure_D_results$session)
figure_E_results$session <- as.numeric(figure_E_results$session)
figure_F_results$session <- as.numeric(figure_F_results$session)

republican_sessions <- data.frame(
  session_start = c(108, 114, 115, 116, 118),
  session_end = c(109, 114, 115, 117, 118)
)
```

## Figures A & B
```{r}

# Figure A
plot_A <- ggplot(data = figure_A_results, aes(x = session, y = prop_pos_all_H)) +
  geom_point(color = "blue") +
  geom_point(aes(y = prop_neg_all_H), color = "red") +
  labs(x = "Session", y = "Proportion", title = "Figure A") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top") +
  coord_cartesian(ylim = c(0, 1)) + # Set y-axis range
    geom_rect(
    data = republican_sessions,
    aes(xmin = session_start - 0.5, xmax = session_end + 0.5,ymin = 0,ymax = 1),
    fill = "darkred",
    alpha = 0.2,
    inherit.aes = FALSE)+scale_x_continuous(labels = function(x) as.integer(x))

# Figure B
plot_B <- ggplot(data = figure_B_results, aes(x = session, y = prop_pos_all_S)) +
  geom_point(color = "blue") +
  geom_point(aes(y = prop_neg_all_S), color = "red") +
  labs(x = "Session", y = "Proportion", title = "Figure B") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top") +
  coord_cartesian(ylim = c(0, 1)) + # Set y-axis range
    geom_rect(
    data = republican_sessions,
    aes(xmin = session_start - 0.5, xmax = session_end + 0.5,ymin = 0,ymax = 1),
    fill = "darkred",
    alpha = 0.2,
    inherit.aes = FALSE)+scale_x_continuous(labels = function(x) as.integer(x))
  

# Arrange plots side by side
plots_A_B <- grid.arrange(plot_A, plot_B, ncol = 2)

```


## Figures C & D
```{r}

# Figure C
plot_C <- ggplot(data = figure_C_results, aes(x = session, y = prop_pos_within_H)) +
  geom_point(color = "blue") +
  geom_point(aes(y = prop_neg_between_H), color = "red") +
  labs(x = "Session", y = "Proportion", title = "Figure C") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top") +
  coord_cartesian(ylim = c(0.8, 1)) + # Set y-axis range
    geom_rect(
    data = republican_sessions,
    aes(xmin = session_start - 0.5, xmax = session_end + 0.5,ymin = 0,ymax = 1),
    fill = "darkred",
    alpha = 0.2,
    inherit.aes = FALSE)+scale_x_continuous(labels = function(x) as.integer(x))

# Figure D
plot_D <- ggplot(data = figure_D_results, aes(x = session, y = prop_pos_within_S)) +
  geom_point(color = "blue") +
  geom_point(aes(y = prop_neg_between_S), color = "red") +
  labs(x = "Session", y = "Proportion", title = "Figure D") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top") +
  coord_cartesian(ylim = c(0.8, 1))  + # Set y-axis range
    geom_rect(
    data = republican_sessions,
    aes(xmin = session_start - 0.5, xmax = session_end + 0.5,ymin = 0,ymax = 1),
    fill = "darkred",
    alpha = 0.2,
    inherit.aes = FALSE)+scale_x_continuous(labels = function(x) as.integer(x))

# Arrange plots side by side
plots_C_D <- grid.arrange(plot_C, plot_D, ncol = 2)

```

## Figures E & F
```{r}

# Figure E
plot_E <- ggplot(data = figure_E_results, aes(x = session, y = prop_neg_within_dem_H)) +
  geom_point(color = "blue") +
  geom_point(aes(y = prop_neg_within_rep_H), color = "red") +
  labs(x = "Session", y = "Proportion", title = "Figure E") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top") +
  coord_cartesian(ylim = c(0, 0.1))  + # Set y-axis range
    geom_rect(
    data = republican_sessions,
    aes(xmin = session_start - 0.5, xmax = session_end + 0.5,ymin = 0,ymax = 1),
    fill = "darkred",
    alpha = 0.2,
    inherit.aes = FALSE)+scale_x_continuous(labels = function(x) as.integer(x))

# Figure F
plot_F <- ggplot(data = figure_F_results, aes(x = session, y = prop_neg_within_dem_S)) +
  geom_point(color = "blue") +
  geom_point(aes(y = prop_neg_within_rep_S), color = "red") +
  labs(x = "Session", y = "Proportion", title = "Figure F") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top") +
  coord_cartesian(ylim = c(0, 0.1))  + # Set y-axis range
    geom_rect(
    data = republican_sessions,
    aes(xmin = session_start - 0.5, xmax = session_end + 0.5,ymin = 0,ymax = 1),
    fill = "darkred",
    alpha = 0.2,
    inherit.aes = FALSE)+scale_x_continuous(labels = function(x) as.integer(x))

# Arrange plots side by side
plots_E_F <- grid.arrange(plot_E, plot_F, ncol = 2)

```

Save plots.
```{r}
ggsave(filename = "figures/A_&_B.jpg", plot = plots_A_B, device = "jpeg")
ggsave(filename = "figures/C_&_D.jpg", plot = plots_C_D, device = "jpeg")
ggsave(filename = "figures/E_&_F.jpg", plot = plots_E_F, device = "jpeg")

```

